# Worker configuration (loaded by worker.config.WorkerSettings)
# Copy to .env and adjust values for your environment.

ASTRA_WORKER_SCHEDULER_WS_URL=ws://localhost:8080/ws/worker
ASTRA_WORKER_SCHEDULER_REST_BASE_URL=http://localhost:8080/api/v1
ASTRA_WORKER_TENANT=default
ASTRA_WORKER_WORKER_NAME=worker-local
ASTRA_WORKER_WORKER_INSTANCE_ID=
ASTRA_WORKER_AUTH_TOKEN=changeme-token
ASTRA_WORKER_WORKER_VERSION=0.1.0
ASTRA_WORKER_HANDSHAKE_PROTOCOL_VERSION=1
ASTRA_WORKER_AUTH_MODE=token
ASTRA_WORKER_AUTH_FINGERPRINT=
ASTRA_WORKER_TRANSPORT=websocket

# Heartbeats & reliability
ASTRA_WORKER_HEARTBEAT_INTERVAL_SECONDS=30
ASTRA_WORKER_HEARTBEAT_JITTER_SECONDS=5
ASTRA_WORKER_ACK_RETRY_BASE_MS=200
ASTRA_WORKER_ACK_RETRY_MAX_MS=5000
ASTRA_WORKER_ACK_RETRY_ATTEMPTS=6

# Session sequencing / resume (sliding window + ack bitmap)
ASTRA_WORKER_SESSION_ACCEPT_TIMEOUT_SECONDS=10
ASTRA_WORKER_SESSION_WINDOW_SIZE=64
# Reconnect backoff (seconds)
ASTRA_WORKER_RECONNECT_BASE_DELAY_SECONDS=1.0
ASTRA_WORKER_RECONNECT_MAX_DELAY_SECONDS=30.0
ASTRA_WORKER_RECONNECT_JITTER=0.2
ASTRA_WORKER_RECONNECT_ABORT_ON_AUTH_ERROR=false
ASTRA_WORKER_RECONNECT_ABORT_ON_PROTOCOL_ERROR=false
# Queue limits (0 = unbounded)
ASTRA_WORKER_TRANSPORT_RECV_QUEUE_MAX=0
ASTRA_WORKER_SESSION_APP_QUEUE_MAX=1024
ASTRA_WORKER_SESSION_APP_QUEUE_OVERFLOW=block
# Max concurrent biz handler tasks (0 = sequential)
ASTRA_WORKER_HANDLER_DISPATCH_MAX_INFLIGHT=8
# Max size of per-type dispatch queues (0 = unbounded)
ASTRA_WORKER_HANDLER_DISPATCH_QUEUE_MAX=256
ASTRA_WORKER_HANDLER_DISPATCH_QUEUE_OVERFLOW=block
ASTRA_WORKER_HANDLER_DISPATCH_QUEUE_IDLE_SECONDS=300
# Handler execution timeout/cooldown (0 = disabled)
ASTRA_WORKER_HANDLER_DISPATCH_TIMEOUT_SECONDS=0
ASTRA_WORKER_HANDLER_DISPATCH_MAX_FAILURES=0
ASTRA_WORKER_HANDLER_DISPATCH_FAILURE_COOLDOWN_SECONDS=0

# Concurrency and capabilities
ASTRA_WORKER_CONCURRENCY_MAX_PARALLEL=1
# JSON map of node type -> limit (optional)
ASTRA_WORKER_CONCURRENCY_PER_NODE_LIMITS={"playwright.open_page":2}
# Handler execution mode (auto=thread for sync, inline for async)
ASTRA_WORKER_HANDLER_EXEC_MODE_DEFAULT=auto
ASTRA_WORKER_RUNTIME_NAMES=["python"]
ASTRA_WORKER_FEATURE_FLAGS=[]
# Optional override of advertised payload types (defaults cover biz.* frames)
# ASTRA_WORKER_PAYLOAD_TYPES=["biz.exec.dispatch","biz.exec.result"]

# Paths and logging
ASTRA_WORKER_PACKAGES_DIR=./node-packages
ASTRA_WORKER_DATA_DIR=./var/data
ASTRA_WORKER_LOG_LEVEL=INFO

# Optional: override default packages root used by PackageManager
ASTRA_PACKAGES_ROOT=./node-packages

# Scheduler API process (uvicorn) bind/logging
SCHEDULER_API_HOST=127.0.0.1
SCHEDULER_API_PORT=8080
SCHEDULER_API_RELOAD=false
SCHEDULER_API_LOG_LEVEL=info

# Scheduler control-plane auth/session config (worker WebSocket)
ASTRA_SCHEDULER_WORKER_TOKEN=changeme-token
# ASTRA_SCHEDULER_WORKER_TOKENS=token-a,token-b

# Session resume & sequencing on scheduler side
ASTRA_SCHEDULER_SESSION_SECRET=dev-session-secret
ASTRA_SCHEDULER_SESSION_TOKEN_TTL_SECONDS=3600
ASTRA_SCHEDULER_SESSION_WINDOW_SIZE=64
ASTRA_SCHEDULER_DISPATCH_WORKER_STRATEGY=default
ASTRA_SCHEDULER_DISPATCH_WORKER_MAX_HEARTBEAT_AGE_SECONDS=90

# Optional: point to a YAML/JSON config file instead of defaults
# ASTRA_WORKER_CONFIG_FILE=./config/worker.yaml
