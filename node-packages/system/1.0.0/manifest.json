{
  "schemaVersion": "1.0.0",
  "name": "system",
  "version": "1.0.0",
  "description": "Scheduler managed control-plane nodes.",
  "adapters": [
    {
      "name": "scheduler",
      "entrypoint": "adapters.container",
      "capabilities": [
        "workflow.container",
        "system.loop_middleware",
        "system.case_middleware",
        "system.input_generator",
        "system.upload_test"
      ]
    }
  ],
  "python": {
    "requires": ">=3.10,<3.12",
    "dependencies": []
  },
  "nodes": [
    {
      "type": "workflow.container",
      "role": "container",
      "status": "published",
      "category": "System",
      "label": "Workflow Container",
      "description": "Executes a nested workflow subgraph.",
      "adapter": "scheduler",
      "handler": "container",
      "config": {},
      "schema": {
        "parameters": {
          "type": "object",
          "properties": {
            "__container": {
              "type": "object",
              "properties": {
                "subgraphId": {
                  "type": "string",
                  "description": "Identifier of the subgraph definition to run."
                },
                "timeoutSeconds": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Optional runtime timeout for the nested workflow."
                }
              },
              "required": ["subgraphId"],
              "additionalProperties": true
            }
          },
          "required": ["__container"],
          "additionalProperties": true
        },
        "results": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "ui": {
        "widgets": [
          {
            "key": "subgraph",
            "label": "Target Subgraph",
            "component": "subgraph-picker",
            "binding": {
              "path": "/parameters/__container/subgraphId",
              "mode": "write"
            },
            "options": {
              "placeholder": "Choose subgraph..."
            }
          },
          {
            "key": "openSubgraph",
            "label": "Open Selected Subgraph",
            "component": "subgraph-jump",
            "binding": {
              "path": "/parameters/__container/subgraphId",
              "mode": "read"
            },
            "options": {
              "buttonLabel": "Jump to subgraph"
            }
          },
          {
            "key": "timeoutSeconds",
            "label": "Timeout (s)",
            "component": "number",
            "binding": {
              "path": "/parameters/__container/timeoutSeconds",
              "mode": "two_way"
            },
            "options": {
              "min": 1
            }
          }
        ]
      }
    },
    {
      "type": "system.loop_middleware",
      "role": "middleware",
      "status": "published",
      "category": "System",
      "label": "Loop Middleware",
      "description": "Repeatedly calls the next middleware/host a fixed number of times.",
      "adapter": "scheduler",
      "handler": "loop_middleware",
      "config": {},
      "schema": {
        "parameters": {
          "type": "object",
          "properties": {
            "times": {
              "type": "integer",
              "minimum": 1,
              "default": 1,
              "description": "Number of times to invoke the next handler."
            },
            "delayMs": {
              "type": "integer",
              "minimum": 0,
              "description": "Optional delay between iterations (milliseconds)."
            },
            "stopOnError": {
              "type": "boolean",
              "default": true,
              "description": "Stop looping when an iteration raises an error."
            }
          },
          "required": [
            "times"
          ],
          "additionalProperties": true
        },
        "results": {
          "type": "object",
          "properties": {
            "iterations": {
              "type": "integer",
              "description": "Total iterations attempted."
            },
            "succeeded": {
              "type": "integer",
              "description": "Number of successful iterations."
            },
            "failures": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "iteration": {
                    "type": "integer"
                  },
                  "error": {
                    "type": "string"
                  }
                },
                "required": [
                  "iteration",
                  "error"
                ]
              }
            },
            "responses": {
              "type": "array",
              "items": {
                "type": "object"
              },
              "description": "Raw responses from each iteration."
            }
          },
          "additionalProperties": true
        }
      },
      "ui": {
        "inputPorts": [
          {
            "key": "times",
            "label": "Iterations",
            "binding": {
              "path": "/parameters/times",
              "mode": "write"
            }
          },
          {
            "key": "delayMs",
            "label": "Delay (ms)",
            "binding": {
              "path": "/parameters/delayMs",
              "mode": "write"
            }
          },
          {
            "key": "stopOnError",
            "label": "Stop On Error",
            "binding": {
              "path": "/parameters/stopOnError",
              "mode": "write"
            }
          }
        ],
        "outputPorts": [
          {
            "key": "iterations",
            "label": "Iterations",
            "binding": {
              "path": "/results/iterations",
              "mode": "read"
            }
          },
          {
            "key": "succeeded",
            "label": "Succeeded",
            "binding": {
              "path": "/results/succeeded",
              "mode": "read"
            }
          },
          {
            "key": "failures",
            "label": "Failures",
            "binding": {
              "path": "/results/failures",
              "mode": "read"
            }
          },
          {
            "key": "responses",
            "label": "Responses",
            "binding": {
              "path": "/results/responses",
              "mode": "read"
            }
          }
        ],
        "widgets": [
          {
            "key": "times",
            "label": "Iterations",
            "component": "number",
            "binding": {
              "path": "/parameters/times",
              "mode": "two_way"
            },
            "options": {
              "min": 1
            }
          },
          {
            "key": "delayMs",
            "label": "Delay (ms)",
            "component": "number",
            "binding": {
              "path": "/parameters/delayMs",
              "mode": "two_way"
            },
            "options": {
              "min": 0
            }
          },
          {
            "key": "stopOnError",
            "label": "Stop On Error",
            "component": "checkbox",
            "binding": {
              "path": "/parameters/stopOnError",
              "mode": "two_way"
            }
          },
          {
            "key": "iterations",
            "label": "Current Iteration",
            "component": "number",
            "binding": {
              "path": "/results/iterations",
              "mode": "read"
            },
            "options": {
              "readOnly": true
            }
          }
        ]
      }
    },
    {
      "type": "system.case_middleware",
      "role": "middleware",
      "status": "published",
      "category": "System",
      "label": "Case Middleware",
      "description": "Conditionally short-circuits the middleware chain/host when disabled.",
      "adapter": "scheduler",
      "handler": "case_middleware",
      "config": {},
      "schema": {
        "parameters": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "When false, the middleware chain stops and host completes."
            }
          },
          "required": [
            "enabled"
          ],
          "additionalProperties": true
        },
        "results": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Evaluated flag."
            },
            "skipped": {
              "type": "boolean",
              "description": "True when the chain was short-circuited (disabled)."
            }
          },
          "additionalProperties": true
        }
      },
      "ui": {
        "inputPorts": [
          {
            "key": "enabled",
            "label": "Enabled",
            "binding": {
              "path": "/parameters/enabled",
              "mode": "write"
            }
          }
        ],
        "outputPorts": [
          {
            "key": "enabled",
            "label": "Enabled",
            "binding": {
              "path": "/results/enabled",
              "mode": "read"
            }
          },
          {
            "key": "skipped",
            "label": "Skipped",
            "binding": {
              "path": "/results/skipped",
              "mode": "read"
            }
          }
        ],
        "widgets": [
          {
            "key": "enabled",
            "label": "Enabled",
            "component": "checkbox",
            "binding": {
              "path": "/parameters/enabled",
              "mode": "two_way"
            }
          }
        ]
      }
    },
    {
      "type": "system.input_generator",
      "status": "published",
      "category": "System",
      "label": "Input Generator",
      "description": "Emit a typed value for quick testing (number, float, string, text, textarea).",
      "adapter": "scheduler",
      "handler": "input_generator",
      "config": {},
      "schema": {
        "parameters": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["number", "float", "string", "text", "textarea", "boolean"],
              "default": "string",
              "description": "Output type to emit."
            },
            "value": {
              "description": "Value to emit (interpreted according to the selected type)."
            }
          },
          "required": ["type"],
          "additionalProperties": true
        },
        "results": {
          "type": "object",
          "properties": {
            "value": {
              "description": "Parsed value"
            },
            "raw": {
              "description": "Original input before parsing"
            },
            "type": {
              "type": "string",
              "description": "Type used for parsing"
            }
          },
          "additionalProperties": true
        }
      },
      "ui": {
        "inputPorts": [
          {
            "key": "type",
            "label": "Type",
            "binding": {
              "path": "/parameters/type",
              "mode": "write"
            }
          },
          {
            "key": "input",
            "label": "Input",
            "binding": {
              "path": "/parameters/value",
              "mode": "write"
            }
          }
        ],
        "outputPorts": [
          {
            "key": "value",
            "label": "Value",
            "binding": {
              "path": "/results/value",
              "mode": "read"
            }
          },
          {
            "key": "raw",
            "label": "Raw",
            "binding": {
              "path": "/results/raw",
              "mode": "read"
            }
          },
          {
            "key": "type",
            "label": "Type",
            "binding": {
              "path": "/results/type",
              "mode": "read"
            }
          }
        ],
        "widgets": [
          {
            "key": "typedInput",
            "label": "Input",
            "component": "typed-input",
            "binding": {
              "path": "/parameters/value",
              "mode": "two_way"
            },
            "options": {
              "typePath": "/parameters/type",
              "options": ["number", "float", "string", "text", "textarea", "boolean"]
            }
          }
        ]
      }
    },
    {
      "type": "system.upload_test",
      "status": "published",
      "category": "System",
      "label": "Upload Tester",
      "description": "Upload files via the file-upload widget and echo stored metadata.",
      "tags": [
        "test",
        "uploads"
      ],
      "adapter": "scheduler",
      "handler": "upload_test",
      "config": {},
      "schema": {
        "parameters": {
          "type": "object",
          "properties": {
            "resources": {
              "type": "array",
              "description": "Uploaded resources selected in the UI.",
              "items": {
                "type": "object",
                "additionalProperties": true
              },
              "default": []
            }
          },
          "required": [],
          "additionalProperties": true
        },
        "results": {
          "type": "object",
          "properties": {
            "count": {
              "type": "integer",
              "description": "Number of uploaded resources."
            },
            "resourceIds": {
              "type": "array",
              "description": "Uploaded resource ids.",
              "items": {
                "type": "string"
              }
            },
            "filenames": {
              "type": "array",
              "description": "Uploaded filenames.",
              "items": {
                "type": "string"
              }
            },
            "sizes": {
              "type": "array",
              "description": "Uploaded file sizes.",
              "items": {
                "type": "integer"
              }
            },
            "resources": {
              "type": "array",
              "description": "Raw resource metadata.",
              "items": {
                "type": "object"
              }
            }
          },
          "additionalProperties": true
        }
      },
      "ui": {
        "inputPorts": [
          {
            "key": "resources",
            "label": "Uploads",
            "binding": {
              "path": "/parameters/resources",
              "mode": "write"
            }
          }
        ],
        "outputPorts": [
          {
            "key": "count",
            "label": "Count",
            "binding": {
              "path": "/results/count",
              "mode": "read"
            }
          },
          {
            "key": "resourceIds",
            "label": "Resource Ids",
            "binding": {
              "path": "/results/resourceIds",
              "mode": "read"
            }
          }
        ],
        "widgets": [
          {
            "key": "uploads",
            "label": "Upload Files",
            "component": "file-upload",
            "binding": {
              "path": "/parameters/resources",
              "mode": "two_way"
            },
            "options": {
              "multiple": true,
              "maxFiles": 10,
              "maxBytes": 1073741824,
              "chunkParallel": 4,
              "maxParallel": 5,
              "helperText": "Upload files to attach to this node (max 1 GB each).",
              "deleteOnRemove": true
            }
          },
          {
            "key": "count",
            "label": "Uploaded Count",
            "component": "number",
            "binding": {
              "path": "/results/count",
              "mode": "read"
            }
          },
          {
            "key": "resourceIds",
            "label": "Resource Ids",
            "component": "json",
            "binding": {
              "path": "/results/resourceIds",
              "mode": "read"
            },
            "options": {
              "rows": 4
            }
          },
          {
            "key": "resources",
            "label": "Resource Metadata",
            "component": "json",
            "binding": {
              "path": "/results/resources",
              "mode": "read"
            },
            "options": {
              "rows": 6
            }
          }
        ]
      }
    }
  ],
  "resources": [],
  "hooks": {
    "install": [],
    "uninstall": []
  }
}



